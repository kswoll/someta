<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /Someta.Docs/ExtensionPoints/MethodInterceptors.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Method Interceptors

Someta supports method interceptors.  What this means is that when you decorate your method with an implementation of one or both of `IMethodInterceptor` and `IAsyncMethodInterceptor` you can have your own code called instead.  Both kinds allow you to call the original implementation via a provided delegate.

The reason we have two types of interfaces is that for async interceptors, there's a good chance you'll want to use `await`.  Since `await` requires the return type of the interceptor 


## [IMethodInterceptor](/Someta/IMethodInterceptor.cs)

This interface has one method:

<!-- snippet: MethodInterceptor -->
<a id='snippet-methodinterceptor'></a>
```cs
object Invoke(MethodInfo methodInfo, object instance, object[] arguments, Func<object[], object> invoker);
```
<sup><a href='/Someta/IMethodInterceptor.cs#L25-L27' title='Snippet source file'>snippet source</a> | <a href='#snippet-methodinterceptor' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


### Example

<!-- snippet: StateExtensionPointExample -->
<a id='snippet-stateextensionpointexample'></a>
```cs
public void StateExample()
{
    var testClass = new StateExtensionPointTestClass();
    testClass.Run();
    var extensionPoint = ExtensionPoint.GetExtensionPoint<StateExtensionPoint>(testClass.GetType());
    var invocationCount = extensionPoint.GetCurrentValue(testClass);
    Console.WriteLine(invocationCount);     // Prints 1
}

[StateExtensionPoint]
class StateExtensionPointTestClass
{
    public int Value { get; set; }

    public void Run()
    {
    }
}

[AttributeUsage(AttributeTargets.Class)]
class StateExtensionPoint : Attribute, IStateExtensionPoint, IMethodInterceptor
{
    public InjectedField<int> TestField { get; set; } = default!;

    public object? Invoke(MethodInfo methodInfo, object instance, object[] arguments, Func<object[], object> invoker)
    {
        var value = TestField.GetValue(instance);
        var newValue = value + 1;
        TestField.SetValue(instance, newValue);
        return null;
    }

    public int GetCurrentValue(object instance) => TestField.GetValue(instance);
}
```
<sup><a href='/Someta.Docs/Samples/StateExtensionPointExample.cs#L10-L45' title='Snippet source file'>snippet source</a> | <a href='#snippet-stateextensionpointexample' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->


## [IAsyncMethodInterceptor](/Someta/IAsyncMethodInterceptor.cs)

This interface has one method:

<!-- snippet: AsyncMethodInterceptor -->
<a id='snippet-asyncmethodinterceptor'></a>
```cs
Task<object> InvokeAsync(MethodInfo methodInfo, object instance, object[] arguments, Func<object[], Task<object>> invoker);
```
<sup><a href='/Someta/IAsyncMethodInterceptor.cs#L26-L28' title='Snippet source file'>snippet source</a> | <a href='#snippet-asyncmethodinterceptor' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
