<!--
GENERATED FILE - DO NOT EDIT
This file was generated by [MarkdownSnippets](https://github.com/SimonCropp/MarkdownSnippets).
Source File: /Someta.Docs/ExtensionPoints/MethodInterceptors.source.md
To change this file edit the source file and then run MarkdownSnippets.
-->

# Method Interceptors

Someta supports method interceptors.  What this means is that when you decorate your method with an implementation of one or both of `IMethodInterceptor` and `IAsyncMethodInterceptor` you can have your own code called instead.  Both kinds allow you to call the original implementation via a provided delegate.

The reason we have two types of interfaces is that for async interceptors, there's a good chance you'll want to use `await`.  Since `await` requires the return type of the interceptor method to return a `Task`, you have to have a separate implementation for async methods if you actually want to make use of `await` in your interceptor.

However, you _are_ allowed to _only_ implement `IMethodInterceptor`.  If you don't _also_ implement `IAsyncMethodInterceptor` then the `Invoke` method defined in `IMethodInterceptor` will be called for _all_ methods, both async and non-async.


## [IMethodInterceptor](/Someta/IMethodInterceptor.cs)

This interface has one method:

<!-- snippet: MethodInterceptor -->
<a id='snippet-methodinterceptor'></a>
```cs
object Invoke(MethodInfo methodInfo, object instance, Type[] typeArguments, object[] arguments, Func<object[], object> invoker);
```
<sup><a href='/Someta/IMethodInterceptor.cs#L26-L28' title='Snippet source file'>snippet source</a> | <a href='#snippet-methodinterceptor' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

### Example

<!-- snippet: MethodInterceptorExample -->
<a id='snippet-methodinterceptorexample'></a>
```cs
public void MethodExample()
{
    var testClass = new MethodTestClass();
    testClass.Method();
    Console.WriteLine(testClass.InvocationCount);     // Prints 1
}

class MethodTestClass
{
    [MethodInterceptor]
    public void Method()
    {
    }

    public int InvocationCount { get; set; }
}

[AttributeUsage(AttributeTargets.Method)]
class MethodInterceptor : Attribute, IMethodInterceptor
{
    public object Invoke(MethodInfo methodInfo, object instance, Type[] typeArguments, object[] arguments, Func<object[], object> invoker)
    {
        ((MethodTestClass)instance).InvocationCount++;
        return invoker(arguments);
    }
}
```
<sup><a href='/Someta.Docs/Source/Samples/MethodInterceptorExample.cs#L10-L37' title='Snippet source file'>snippet source</a> | <a href='#snippet-methodinterceptorexample' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

## [IAsyncMethodInterceptor](/Someta/IAsyncMethodInterceptor.cs)

This interface has one method:

<!-- snippet: AsyncMethodInterceptor -->
<a id='snippet-asyncmethodinterceptor'></a>
```cs
Task<object> InvokeAsync(MethodInfo methodInfo, object instance, Type[] typeArguments, object[] arguments, Func<object[], Task<object>> invoker);
```
<sup><a href='/Someta/IAsyncMethodInterceptor.cs#L26-L28' title='Snippet source file'>snippet source</a> | <a href='#snippet-asyncmethodinterceptor' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->

### Example

<!-- snippet: AsyncMethodInterceptorExample -->
<a id='snippet-asyncmethodinterceptorexample'></a>
```cs
public async Task AsyncMethodExample()
{
    var testClass = new AsyncMethodTestClass();
    await testClass.AsyncMethod();
    testClass.InvocationCount.ShouldBe(1);
}

class AsyncMethodTestClass
{
    [AsyncMethodInterceptor]
    public async Task AsyncMethod()
    {
        await Task.Delay(0);        // Just to force await semantics
    }

    public int InvocationCount { get; set; }
}

[AttributeUsage(AttributeTargets.Method)]
class AsyncMethodInterceptor : Attribute, IAsyncMethodInterceptor
{
    public async Task<object> InvokeAsync(MethodInfo methodInfo, object instance, Type[] typeArguments, object[] arguments, Func<object[], Task<object>> invoker)
    {
        await Task.Delay(0);        // Just to demonstrate await semantics
        ((AsyncMethodTestClass)instance).InvocationCount++;
        return await invoker(arguments);
    }
}
```
<sup><a href='/Someta.Docs/Source/Samples/AsyncMethodInterceptorExample.cs#L11-L40' title='Snippet source file'>snippet source</a> | <a href='#snippet-asyncmethodinterceptorexample' title='Start of snippet'>anchor</a></sup>
<!-- endSnippet -->
